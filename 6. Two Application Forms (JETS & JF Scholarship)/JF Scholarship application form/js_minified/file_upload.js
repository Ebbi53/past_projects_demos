define(["jquery","underscore","backbone","jquery.iframe-transport","fileUpload","model/session","api_config","core-js/modules/es6.array.find","core-js/modules/es6.function.name","core-js/modules/es7.array.includes","core-js/modules/es6.string.includes"],function(a,b,c,d,e,f,g){var h={},i={},j="",k=function(){return j};return{init:function(){a("input[type=file]").each(function(){h[a(this).attr("name")]="",a(this).fileupload({url:g.protocol+g.domain+g.path+"document",maxFileSize:4e6,//4MB //Not supported by all browsers
dataType:"json",formData:{data:JSON.stringify({token:f.get("applicationtoken")}),"file-meta-data":{}},add:function(b,d){// if (!(await Session.checkExpiry())) {
//     data.submit()
// }
if("others_doc"==a(this).attr("name")){if(8e6<d.files[0].size)return c.Events.trigger("showError","fileSize"),!1;}else if(4e6<d.files[0].size)return c.Events.trigger("showError","fileSize"),!1;if("photo"==a(this).attr("name")){if(!d.files[0].name.toLowerCase().includes(".jpg")&&!d.files[0].name.toLowerCase().includes(".jpeg"))return c.Events.trigger("showError","fileType"),!1;}else if(!d.files[0].name.toLowerCase().includes(a(this).attr("accept")))return c.Events.trigger("showError","fileType"),!1;i[a(this).attr("name")]=d.submit()},submit:function(){},send:function(){a(this).parents("button").children("div").toggle(),a(this).parents(".form-group").children("div.uploadProgress").removeClass("hidden")},progress:function b(c,d){var b=parseInt(100*(d.loaded/d.total),10);a(this).parents(".form-group").find("div.progress div.progress-bar").css("width",b+"%"),100==b},done:function(b,d){if(a(this).parents(".form-group").children("div.uploadProgress").addClass("hidden"),a(this).parents(".form-group").find("div.progress div.progress-bar").css("width",0),a(this).parents("button").children("div").toggle(),!(0<d.result.result_code))-2==d.result.result_code?c.Events.trigger("showError","fileType"):-3==d.result.result_code?c.Events.trigger("showError","fileSize"):(-9==d.result.result_code||-10==d.result.result_code)&&(f.update(),c.Events.trigger("showError","fileUpload"));else if(a(this).parents(".form-group").children("div.uploadBtn").toggle(),a(this).parents(".form-group").find("span.fileStatus i").text(d.files[0].name+" successfully uploaded!"),a(this).parents(".form-group").find(".undoBtn").removeAttr("disabled"),h[a(this).attr("name")]=d.files[0].name,"photo"==d.paramName[0]){var e=new FileReader;e.onload=function(){j=e.result},e.readAsDataURL(d.files[0])}},fail:function(){a(this).parents(".form-group").children("div.uploadProgress").addClass("hidden"),a(this).parents(".form-group").find("div.progress div.progress-bar").css("width",0),a(this).parents("button").children("div").toggle(),"abort"==i[a(this).attr("name")].statusText?"":c.Events.trigger("showError","server")}})})},uploadData:h,jqXHR:i,getFileURL:k}});
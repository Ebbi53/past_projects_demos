define(["jquery","underscore","backbone","text!template/form.html","file_upload","select2","datepicker","data","form_validation","router","model/session","core-js/modules/es6.regexp.match","core-js/modules/es6.regexp.split","core-js/modules/es6.array.for-each","core-js/modules/es6.function.name","core-js/modules/es6.promise","core-js/modules/es6.object.to-string","regenerator-runtime/runtime","core-js/modules/es7.array.includes","core-js/modules/es6.string.includes","core-js/modules/es6.array.find","_asyncToGenerator","api_config"],function(a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){return c.View.extend({tagname:"div",className:"fadeIn container-fluid form_page",template:d,listItem:"",scholarshipCounter:1,counter:1,initialize:function(){this.render()},events:{"change .from":function(b){$from=a(b.currentTarget),$to=$from.parent().parent().next().find(".to"),$to.datepicker("setStartDate",$from.datepicker("getDate")),$to.datepicker("clearDates"),$to.datepicker("show")},"change #home_area_code":function(b){a("#select2-home_area_code-container").text(a(b.currentTarget).val())},"change #mobile_area_code":function(b){a("#select2-mobile_area_code-container").text(a(b.currentTarget).val())},"change #referee_area_code":function(b){a("#select2-referee_area_code-container").text(a(b.currentTarget).val())},"click .section_heading":function(b){a(b.currentTarget.nextElementSibling).slideToggle(300),a(b.currentTarget.children[0].children).toggleClass("hidden")},"click #dual":function(b){a(b.currentTarget).is(":checked")?(a("#nationality2").css("display","block"),a("#second_nationality").addClass("compulsory")):(a("#nationality2").css("display","none"),a("#second_nationality").removeClass("compulsory"))},"change #preferred_university":function(b){a("select[id$=preferred_college] > option").remove();var c=a(b.currentTarget).children("option:selected").val();"cambridge"==c?this.populateDropdown("#preferred_college",i.cambridge_college):"oxford"==c&&this.populateDropdown("#preferred_college",i.oxford_college)},"change #type":"updateQualificationSection","click #add_button":"addNewRecord","click .topnav":function(){a("#myLinks").toggle(200)},"input #statement_content":function(b){if(""==a(b.currentTarget).val())a("#count").hide(200);else{var c=this.count_words(a(b.currentTarget).val());a("#count").show(200),a("#count").html(c+" / 700"),700<c?(a("#count").css("background-color","#CC0000"),a("#statement_content").addClass("incomplete-input invalid")):700==c?(a("#count").css("background-color","orange"),a("#statement_content").removeClass("incomplete-input invalid")):(a("#count").css("background-color","green"),a("#statement_content").removeClass("incomplete-input invalid"))}},"input .num":function(b){this.checkValid(a(b.currentTarget).val(),["0","1","2","3","4","5","6","7","8","9","","-"," ","(",")"])?(a(b.currentTarget).removeClass("incomplete-input invalid"),a(b.currentTarget).next(".invalid_number").hide()):(a(b.currentTarget).addClass("incomplete-input invalid"),a(b.currentTarget).next(".invalid_number").show())},"change .email_address":function(b){valid_email=!1,0==a(b.currentTarget).val().length||a(b.currentTarget).val().includes("@")&&a(b.currentTarget).val().includes(".")?a(b.currentTarget).next(".invalid_email").hide():a(b.currentTarget).next(".invalid_email").show(),""!=a(b.currentTarget).parent().next().find(".conf_email_address").val()&&(a(b.currentTarget).val()==a(b.currentTarget).parent().next().find(".conf_email_address").val()?a(b.currentTarget).parent().next().find(".conf_email_address").nextAll(".invalid_conf_email").hide():a(b.currentTarget).parent().next().find(".conf_email_address").nextAll(".invalid_conf_email").show()),a(b.currentTarget).hasClass("conf_email_address")&&(a(b.currentTarget).val()==a(b.currentTarget).parent().prev().find(".email_address").val()?a(b.currentTarget).nextAll(".invalid_conf_email").hide():a(b.currentTarget).nextAll(".invalid_conf_email").show()),a(".invalid_email").each(function(){"block"==a(this).css("display")||"block"==a(this).next(".invalid_conf_email").css("display")?a(this).prevAll(".email_address").addClass("incomplete-input invalid"):a(this).prevAll(".email_address").removeClass("incomplete-input invalid")}),a(b.currentTarget).hasClass("incomplete-input")||0==a(b.currentTarget).val().length||(valid_email=!0),valid_email&&!a(b.currentTarget).hasClass("secondary_email")&&a.ajax({type:"PUT",data:JSON.stringify({token:l.get("applicationtoken"),email:a("#"+b.currentTarget.id).val()}),contentType:"application/json",url:x.protocol+x.domain+x.path+"application"}).done(function(a){-6==a.result_code?c.Events.trigger("showError","emailReUse"):(-9==a.result_code||-10==a.result_code)&&l.update()})},"click input.specifyInput":function(b){a(b.currentTarget).prop("checked")?(a(b.currentTarget).parents(".form-group").children(".specifyInputBoxDiv").show({duration:100,easing:"linear"}),a(b.currentTarget).parents(".form-group").children(".specifyInputBoxDiv").find("input, select").addClass("compulsory")):this.removeInput(b)},"click input.removeInput":"removeInput","click button.addItem":"addNewScholarshipItem","click button.deleteItem":function(b){this.scholarshipCounter--,a(b.currentTarget).parents("li").remove(),1==a("div.specifyInputBoxDiv ol li button.btn-danger").length&&a("div.specifyInputBoxDiv ol li button.btn-danger").prop("disabled",!0)},"click button.undoBtn":function(b){f.uploadData[a(b.currentTarget).parents(".form-group").find("input").attr("name")]="",a(b.currentTarget).parents(".form-group").children("div.uploadBtn").toggle(),a(b.currentTarget).prop("disabled",!0)},"click #validate_button":function(){var b=w(/*#__PURE__*/regeneratorRuntime.mark(function b(){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,j();case 2:if(!b.sent){b.next=6;break}k.navigate("preview",{trigger:!0}),b.next=8;break;case 6:c.Events.trigger("showError","validation"),a(window).scrollTop(a(a(".sections").has("[class*=incomplete]")[0]).offset().top-(991>=window.innerWidth?a("nav.navbar").outerHeight():0));// $('div.alert div#errorMsg').html('<strong>FORM VALIDATION FAILED</strong><br><hr>Few compulsory fields are incomplete. Please review your form')
// $('div.alert').fadeIn(300);
// setTimeout(() => {
//     $('div.alert').fadeOut(300);
// }, 4000);
case 8:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}(),"click a.nav-link":function(b){b.preventDefault(),a(window).scrollTop(a(a(b.currentTarget).attr("href")).offset().top)},// 'click div.alert span.closebtn': function (e) {
//     $(e.currentTarget).parents('div.alert').fadeOut(300);
//     $('div[class*=container] div.row').css('opacity', 1);
//     // $(window).scrollTop($('#uploaded_files').offset().top - $('div.alert').height() - 20);
//     if ($('div.alert div#errorMsg').html().includes('TIMEOUT')) {
//         if ($('#body').find('#preview').length) {
//             Router.navigate('applicationForm', {
//                 trigger: false
//             })
//         }
//         $(window).scrollTop($('#uploaded_files').offset().top - (window.innerWidth <= 991 ? $('nav.navbar').outerHeight() : 0));
//         $('.undoBtn').not(':disabled').trigger('click');
//     }
//     // $(window).scrollTop($($(e.currentTarget).attr('href')).offset().top);
// },
"click div.uploadProgress div.cancelUpload":function(b){void 0!==f.jqXHR[a(b.currentTarget).parents(".form-group").find("input").prop("name")]&&(f.jqXHR[a(b.currentTarget).parents(".form-group").find("input").prop("name")].abort(),c.Events.trigger("showError","cancelUpload"))},"click div.calicon, div.calLabel":function(b){a(b.currentTarget).siblings("input.datepicker").datepicker("show")}},addNewScholarshipItem:function(){var b=w(/*#__PURE__*/regeneratorRuntime.mark(function b(){var c,d;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=this,d=a(this.listItem),limit=d.find("label, input, select").length-1,this.scholarshipCounter++,b.next=5,new Promise(function(b){d.find("label, input, select").each(function(d){null==a(this).attr("for")?(a(this).attr("name",a(this).attr("name").slice(0,-1)+c.scholarshipCounter),a(this).attr("id",a(this).attr("id").slice(0,-1)+c.scholarshipCounter),a(this).addClass("compulsory")):a(this).attr("for",a(this).attr("for").slice(0,-1)+c.scholarshipCounter),d==limit&&b()})});case 5:a(a("div.specifyInputBoxDiv ol").append(d)[0].lastElementChild).find("select").select2({minimumResultsForSearch:10,placeholder:""}),a("div.specifyInputBoxDiv ol li button.btn-danger").removeAttr("disabled");case 7:case"end":return b.stop();}},b,this)}));return function(){return b.apply(this,arguments)}}(),addNewRecord:function(){this.counter+=1;var b=a("#leadership_experience_1").clone(),c=this;b.attr("id","leadership_experience_".concat(this.counter)),b.find("#record_num").text("Record ".concat(this.counter,":")),b.find("#club_name_1").attr("id","club_name_".concat(this.counter)).val(""),b.find("#club_role_1").attr("id","club_role_".concat(this.counter)).val(""),b.find("#club_from_1").attr("id","club_from_".concat(this.counter)).val("").datepicker({format:"yyyy-mm",startView:2,viewMode:"years",minViewMode:"months",autoclose:!0,todayHighlight:!0}),b.find("#club_to_1").attr("id","club_to_".concat(this.counter)).val("").datepicker({format:"yyyy-mm",startView:2,viewMode:"years",minViewMode:"months",autoclose:!0,todayHighlight:!0}),b.find("#delete_1").attr("id","delete_".concat(this.counter)).click(function(){a(event.target).parents(".leadership_experience").remove(),c.counter--,a(".leadership_experience").each(function(b,c){a(c).find("#record_num").text("Record ".concat(b+1,":")),a(c).attr("id","leadership_experience_".concat(b+1)),a(c).find(".club_name").attr("id","club_name_".concat(b+1)),a(c).find(".club_role").attr("id","club_role_".concat(b+1)),a(c).find(".club_to").attr("id","club_to_".concat(b+1)),a(c).find(".club_from").attr("id","club_from_".concat(b+1)),a(c).find(".delete").attr("id","delete_".concat(b+1))})}),b.append("<hr>"),b.appendTo("#add")},updateQualificationSection:function(b){var c=a(b.currentTarget).children("option:selected").val(),d={"GCE A-Level":{grades:["A*","A","B","C"],name:"gce-grades"},"Hong Kong Diploma of Secondary Education":{grades:["5**","5*","5","4"],name:"dse-grades"},"Malaysia - Higher School Certificate of Education(STPM)":{grades:["A","B","C"],name:"stpm-grades"},"Singapore - Cambridge GCE Advanced Level":{grades:["Distinction","Merit","Pass"],name:"gceal-grades"}},e="";if("International Baccalaureate"==c)a("#grades").html("<div class = 'col'><p>Please input the total mark (0-45)</p><input type = 'number' class = 'form-control-sm col-7 grades' name= 'ib-grades' value=0 min=0 max=45></div>");else if(c.includes("Others"))a("#grades").html("<div class = 'col'><p>Please input the total grades/marks:</p><input type = 'text' class = 'form-control-sm col-7 grades' name= 'others-grades'></div>");else{for(var f="Singapore - Cambridge GCE Advanced Level"==c?0:2;3>f;f++){e+="Singapore - Cambridge GCE Advanced Level"==c?"<div class = 'col-md-3'><p class = 'text-center'><b>H".concat(f+1,"</b></p></div>"):"";for(var g=0;g<d[c].grades.length;g++)e+="<div class = 'col-md-3'><p class = 'text-center'>".concat(d[c].grades[g],"</p><input type = 'number' class = 'form-control-sm grades' name=").concat(d[c].name," value=0 min=0 max=20></div>");e+="Singapore - Cambridge GCE Advanced Level"==c?"</div>":""}a("#grades").html(e)}},populateDropdown:function(b,c){c.forEach(function(c){a(b).append("<option value=\""+c+"\">"+c+"</option>")})},setDatePicker:function(b,c){"days"==c?a(b).datepicker({format:"dd-mm-yyyy",startView:2,viewMode:"years",minViewMode:"days",autoclose:!0,todayHighlight:!0}):"months"==c&&a(b).datepicker({format:"mm-yyyy",startView:2,viewMode:"years",minViewMode:"months",autoclose:!0,todayHighlight:!0})},checkValid:function(a,b){arr=a.split("");var c=!0;if(0<arr.length)for(var d=0;d<arr.length;d++)if(!b.includes(arr[d])){c=!1;break}return c},count_words:function(a){for(var b=a.split(" ").length,c=a.length;c--;)"\n"==a[c]&&(b+=1);return b},bracket_value:function(a){var b=/\(([^)]+)\)/,c=b.exec(a)[0];return c.match(/\(([^)]+)\)/)[1]},removeInput:function(b){a(b.currentTarget).parents(".form-group").children(".specifyInputBoxDiv").hide({duration:100,easing:"linear"}),a(b.currentTarget).parents(".form-group").children(".specifyInputBoxDiv").find("input, select, span").removeClass("compulsory incomplete-input"),a(b.currentTarget).parents(".form-group").children(".specifyInputBoxDiv").find("input, select").each(function(b,c){a(c).val("")})},render:function(){var c=this;this.$el.html(b.template(this.template)),a(document).ready(function(){a("footer").show(),a(window).scrollTop(0),a("body").scrollspy({target:".navbar"}),a("#body").height()+100>window.innerHeight?(a("body").css("position","relative"),a("footer").css("bottom",-a("footer").height()+"px")):(a("body").css("position","static"),a("footer").css("bottom",0));var b=/*@cc_on!@*/!!document.documentMode;// $(window).bind('beforeunload', function() {
//     confirm('Are you sure you want to leave?');
// })
// $('.delete').popover();
// var $new = $('.leadership_experience')
// $('.select2-selection').addClass('compulsory')
b&&(a("input[type=file]").click(function(a){a.stopPropagation()}),a("button.fileinput-button").click(function(b){a(b.currentTarget).find("input").trigger("click")})),c.listItem=a("div.specifyInputBoxDiv ol").html(),a("select").select2({minimumResultsForSearch:10,placeholder:"",tags:!0}),a("#country_of_origin").select2({placeholder:"Select Country",tags:!0}),a("#current_residential_address_country").select2({placeholder:"Select Country",tags:!0}),a("#present_location").select2({placeholder:"Select Country",tags:!0}),a("#nationality").select2({placeholder:"Select Nationality",tags:!0}),a("#second_nationality").select2({placeholder:"Second Nationality",tags:!0}),a("#type").select2({placeholder:"Select Qualification",tags:!0}),a("#home_area_code").select2({placeholder:"Area Code",tags:!0}),a("#mobile_area_code").select2({placeholder:"Area Code",tags:!0}),a("#referee_area_code").select2({placeholder:"Area Code",tags:!0}),c.populateDropdown("#country_of_origin",i.country_list),c.populateDropdown("#current_residential_address_country",i.country_list),c.populateDropdown("#present_location",i.country_list),c.populateDropdown("#nationality",i.nationalities),c.populateDropdown("#second_nationality",i.nationalities),c.populateDropdown("#type",i.qualification_list),c.setDatePicker("#date_of_birth","days"),c.setDatePicker(".to","months"),c.setDatePicker(".from","months"),a(".invalid_number").html("&nbsp;&nbsp;<i><span style=\"color:#CC0000\"><i class=\"fas fa-exclamation\"></i> Invalid Character</span></i>"),a(".invalid_email").html("&nbsp;&nbsp;<i><span style=\"color:#CC0000\"><i class=\"fas fa-exclamation\"></i> Invalid Email</span></i>"),a(".invalid_conf_email").html("&nbsp;&nbsp;<i><span style=\"color:#CC0000\"><i class=\"fas fa-exclamation\"></i> Should be same as the above email</span></i>"),i.country_codes.forEach(function(b){a("#home_area_code").append("<option value=\""+c.bracket_value(b)+"\">"+b+"</option>"),a("#mobile_area_code").append("<option value=\""+c.bracket_value(b)+"\">"+b+"</option>"),a("#referee_area_code").append("<option value=\""+c.bracket_value(b)+"\">"+b+"</option>")}),a(".invalid_number").html("&nbsp;&nbsp;<i><span style=\"color:#CC0000\"><i class=\"fas fa-exclamation\"></i> Invalid Character</span></i>"),a(".invalid_email").html("&nbsp;&nbsp;<i><span style=\"color:#CC0000\"><i class=\"fas fa-exclamation\"></i> Invalid Email</span></i>"),a(".invalid_conf_email").html("&nbsp;&nbsp;<i><span style=\"color:#CC0000\"><i class=\"fas fa-exclamation\"></i> Should be same as the above email</span></i>"),a(".section_heading").hover(function(){a(this).css("color","#115798")},function(){a(this).css("color","black")}),f.init()})}})});